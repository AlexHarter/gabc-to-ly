#+TITLE: gabc-to-ly.py main org file
#+AUTHOR: Alex Harter
[[file:reference/table_of_neumes.pdf][Table of Neumes]]
#+PROPERTY: header-args python :tangle yes :tangle main.py
* TODO init
*** TODO import libraries
#+BEGIN_SRC python :tangle no
  import argparse
  import regex
#+END_SRC
*** TODO take in user args
- /path/to/file.gabc
- in which rhythmic system to interpret
#+BEGIN_SRC python :tangle no
#TODO take in user args
#+END_SRC
* TODO parse data
** TODO import and split gabc
#+BEGIN_SRC python
example_gabc_file_path = "example.gabc"
with open(example_gabc_file_path, 'r') as file:
    gabc = file.read()

print(f"Full GABC: {gabc}")

gabc_header = gabc.split("%%")[0]
gabc_body = gabc.split("%%")[1]

print(f"GABC Header: {gabc_header}")
print(f"GABC Body: {gabc_body}")
#+END_SRC
** TODO header parser
- keep the header parser here since it won't be affected by schools of interpretation, and it's a small amount of code
#+PROPERTY: python :tangle yes :tangle header_parser.py
**** example input/output
***** example input
#+BEGIN_SRC gabc :tangle no
name:Deus Israel;
office-part:Introitus;
mode:3;
user-notes: LU 1288;
transcriber:Andrew Hinkley & Patrick Williams;
commentary: Tob. 7:15 & 8:19, Ps. 127:1;
annotation: IN. III;
#+END_SRC
***** desired output
#+BEGIN_SRC lilypond :tangle no
title = "Deus Israel"
office-part = "Introitus"
mode = 3
user-notes = "LU 1288"
transcriber = "Andrew Hinkley & Patrick Williams"
commentary = "Tob. 7:15 & 8:19, Ps. 127:1"
annotation = "IN. III"
#+END_SRC
**** TODO parser
#+BEGIN_SRC python
  def parse_gabc_header(gabc_header):
    gabc_header_entries = gabc_header.strip().split(";\n")
    gabc_header_dictionary = {}
    for entry in gabc_header_entries:
	key, value = entry.split(":", 1) # in case there are semicolons in the value
	gabc_header_dictionary.update({key.strip(): value.strip()})
      ly_metadata = []
  for key, value in gabc_header_dictionary.items():
      ly_metadata.append(f"{key} = {value}")
  print(f"LilyPond Metadata: {ly_metadata}")
#+END_SRC
** TODO body parser
*** TODO [[file:body_parser-proportional.org][Proportionalist Rhythm]]
*** WAIT classical Solesmes rhythm
*** WAIT Editio Vaticana rhythm
* TODO output
*** TODO Lilypond template
#+BEGIN_SRC lilypond :tangle template.ly
\version "2.24.3"
\include "gregorian.ly"

\header {
  % ly_metadata
}

global = {
  \cadenzaOn
  \omit Staff.TimeSignature
  \key c \major
}

melody = \relative c'' {
  \global
  % ly_melody
}

text = \lyricmode {
  % ly_lyrics
}

\score {
  <<
  \new Staff {
    \context Voice = "vocal" { \melody }
  }
  \new Lyrics \lyricsto "vocal" \text
  >>
}
% tangle from Org-Mode on <2024-06-28>
#+END_SRC
*** TODO Import template
#+BEGIN_SRC python
with open("template.ly", "r") as file:
    ly_template = file.read()
#+END_SRC
*** TODO Interpolate template with data
#+BEGIN_SRC python
ly_template_interpolated = ly_template
ly_template_interpolated = ly_template_interpolated.replace("% ly_metadeta", ''.join(ly_metadata))
ly_template_interpolated = ly_template_interpolated.replace("% ly_melody", ly_melody)
ly_template_interpolated = ly_template_interpolated.replace("% ly_lyrics", ly_lyrics)

with open("chant.ly", "w") as file:
    file.write(ly_template_interpolated)

# tangled from Org-Mode on <2024-06-28>
#+END_SRC
